arn:aws:lambda:us-east-1:241533156429:function:FSA-CERT-DART-ECHO-FETCH

  sh "aws lambda invoke --no-verify-ssl --function-name FSA-CERT-DART-ECHO-FETCH 
  --cli-binary-format raw-in-base64-out 
  --payload '{\"file_pattern\": \"^(FILE_NATS_\\\\w+)\\\\.(\\\\d{8})\\\\.csv\$\",
   \"echo_folder\": \"nats\", \"pipeline\": \"FLPIDS_ODS\", \"step\": \"FLPIDS_ODS Landing Zone\"}' response.json"
            echo "Lambda function invoked successfully."


pipeline {
  agent {
    any {
      reuseNode true
    }
  }
  environment {
    AWS_REGION = 'us-east-1'
    SECRET_NAME = 'FSA-CERT-Secrets'
    LAMBDA_FUNCTION_NAME = ''
  }
  stages {
    stage('Get Secrets') {
      steps {
        withAWS(credentials: 'disc_fsafpac', region: "${env.AWS_REGION}") {
          script {
            def secret = sh(script: "aws secretsmanager get-secret-value --secret-id ${env.SECRET_NAME} --query 'SecretString' --output text --no-verify-ssl", returnStdout: true).trim()
          }
        }
      }
    }
    stage('Invoke Lambda Function') {
      steps {
        withAWS(credentials: 'disc_fsafpac', region: "${env.AWS_REGION}") {
          script {
            sh "aws lambda invoke --no-verify-ssl --function-name FSA-CERT-DART-ECHO-FETCH --cli-binary-format raw-in-base64-out --payload '{\"file_pattern\": \"^(FILE_NATS_\\\\w+)\\\\.(\\\\d{8})\\\\.csv\$\", \"echo_folder\": \"nats\", \"pipeline\": \"FLPIDS_ODS\", \"step\": \"FLPIDS_ODS Landing Zone\"}' response.json"
            echo "Lambda function invoked successfully."
          }
        }
      }
    }
  }
}