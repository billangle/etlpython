pipeline {
    agent any
 
    environment {
      DEPLOY_ENV = 'config/flpidsdev.json'
      AWS_REGION = 'us-east-1'
      PROJECT = 'flpids'
    }
 
    stages {
        stage('Clean Workspace') {
            steps {
                cleanWs()
            }
        }
 
        stage('Checkout Code') {
            steps {
                echo 'Checking out code from Bitbucket'
                script {
                    checkout scm: [
                        $class: 'GitSCM',
                        branches: [[name: 'main']],
                        userRemoteConfigs: [[
                            url: 'https://bitbucket.fpac.usda.gov/scm/fsadm/fpac-py-deploy.git', 
                            credentialsId: 'BitBucketRepoAccess'
                        ]]
                    ]
                }
            }
        }
 
      
        
        stage('Setup AWS Credentials') {
            steps {
                withAWS(credentials: 'disc_fsafpac', region: "${AWS_REGION}") {
                    echo "AWS Credentials set up successfully."
                }
            }
        }
        
        stage('Deploy') {
            steps {
                withAWS(credentials: 'disc_fsafpac', region: "${AWS_REGION}") {
                    sh '''
                        cd deploy;
                        ls -lf
                    '''
                }
            }
        }
    }
}