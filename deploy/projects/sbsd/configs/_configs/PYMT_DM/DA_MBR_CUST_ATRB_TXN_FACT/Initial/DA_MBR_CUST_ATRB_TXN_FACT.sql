INSERT INTO pymt_dm_stg.DA_MBR_CUST_ATRB_TXN_FACT(
acct_pgm_durb_id,
acct_ref_prim_id_type_durb_id,
acct_ref_scnd_id_type_durb_id,
agi_elg_ind,
agi_err_ref_cd,
app_3_ownshp_lvl_lmt_ind,
bus_type_cd,
cash_rent_cpld_fctr,
cmb_pty_pymt_shr_pct,
cmdy_cd,
cre_dt,
--da_mbr_cust_atrb_txn_fact_id, --autogenerated
dart_etl_last_chg_dt,
data_actn_dt,
data_stat_cd,
fgn_prsn_elg_ind,
fsa_st_cnty_durb_id,
fsa_st_cnty_srgt_id,
hrch_pymt_lmt_ind,
last_chg_dt,
latest_pymt_atrb_txn_ind,
ltd_pymt_pgm_durb_id,
ltd_pymt_pgm_srgt_id,
mbr_ctrb_elg_ind,
mbr_ctrb_shr_pct,
mbr_cust_durb_id,
mbr_cust_srgt_id,
mbr_rpt_fsa_st_cnty_durb_id,
mbr_rpt_fsa_st_cnty_srgt_id,
mbr_shr_pct,
net_pymt_amt,
obl_cnfrm_nbr,
ovrrd_sbsd_prd_strt_yr,
ownshp_hrch_lvl_shr_pct,
paid_pty_shr_pct,
pgm_inelg_rsn_type_cd,
pmit_enty_elg_ind,
prim_cust_durb_id,
prim_cust_srgt_id,
prnt_mbr_cust_durb_id,
prnt_mbr_cust_srgt_id,
prnt_pymt_atrb_id,
proc_rqst_ref_nbr,
prps_pymt_amt,
prps_pymt_data_stat_cd,
prps_pymt_id,
prst_opymt_atrb_ind,
prv_prps_pymt_id,
pymt_atrb_amt,
pymt_atrb_bus_cat_cd,
pymt_atrb_data_stat_cd,
pymt_atrb_id,
pymt_atrb_rvrs_dt,
pymt_atrb_shr_pct,
pymt_lmt_ind,
pymt_lmt_yr,
pymt_pty_rlt_cd,
rcd_ref_prim_id,
rcd_ref_scnd_id,
sbsd_prd_strt_yr,
sbst_chg_elg_ind,
src_cre_dt,
src_cre_user_nm,
src_last_chg_dt,
src_last_chg_user_nm,
tax_id_type_cd,
tot_net_pymt_amt,
tot_pymt_atrb_amt
)
Select /*+ parallel (24) */
DV.ACCT_PGM_DURB_ID,
DV.ACCT_REF_PRIM_ID_TYPE_DURB_ID,
DV.ACCT_REF_SCND_ID_TYPE_DURB_ID,
DV.AGI_ELG_IND,
DV.AGI_ERR_REF_CD,
DV.APP_3_OWNSHP_LVL_LMT_IND,
DV.BUS_TYPE_CD,
DV.CASH_RENT_CPLD_FCTR,
DV.CMB_PTY_PYMT_SHR_PCT,
DV.CMDY_CD,
TO_TIMESTAMP ('{ETL_START_DATE}', 'YYYY-MM-DD HH24:MI:SS.FF') CRE_DT, 
TO_TIMESTAMP('{ETL_START_DATE}', 'YYYY-MM-DD HH24:MI:SS.FF') DART_ETL_LAST_CHG_DT,
DV.DATA_ACTN_DT,
'A' DATA_STAT_CD,
DV.FGN_PRSN_ELG_IND,
DV.FSA_ST_CNTY_DURB_ID,
DV.FSA_ST_CNTY_SRGT_ID,
DV.HRCH_PYMT_LMT_IND,
TO_TIMESTAMP ('{ETL_START_DATE}', 'YYYY-MM-DD HH24:MI:SS.FF') LAST_CHG_DT,
1 as LATEST_PYMT_ATRB_TXN_IND,
DV.LTD_PYMT_PGM_DURB_ID,
DV.LTD_PYMT_PGM_SRGT_ID,
DV.MBR_CTRB_ELG_IND,
DV.MBR_CTRB_SHR_PCT,
DV.MBR_CUST_DURB_ID,
DV.MBR_CUST_SRGT_ID,
DV.MBR_RPT_FSA_ST_CNTY_DURB_ID,
DV.MBR_RPT_FSA_ST_CNTY_SRGT_ID,
DV.MBR_SHR_PCT,
DV.NET_PYMT_AMT,
DV.OBL_CNFRM_NBR,
DV.OVRRD_SBSD_PRD_STRT_YR,
DV.OWNSHP_HRCH_LVL_SHR_PCT,
DV.PAID_PTY_SHR_PCT,
DV.PGM_INELG_RSN_TYPE_CD,
DV.PMIT_ENTY_ELG_IND,
DV.PRIM_CUST_DURB_ID,
DV.PRIM_CUST_SRGT_ID,
DV.PRNT_MBR_CUST_DURB_ID,
DV.PRNT_MBR_CUST_SRGT_ID,
DV.PRNT_PYMT_ATRB_ID,
DV.PROC_RQST_REF_NBR,
DV.PRPS_PYMT_AMT,
DV.PRPS_PYMT_DATA_STAT_CD,
DV.PRPS_PYMT_ID,
DV.PRST_OPYMT_ATRB_IND,
DV.PRV_PRPS_PYMT_ID,
DV.PYMT_ATRB_AMT,
DV.PYMT_ATRB_BUS_CAT_CD,
DV.PYMT_ATRB_DATA_STAT_CD,
DV.PYMT_ATRB_ID,
DV.PYMT_ATRB_RVRS_DT,
DV.PYMT_ATRB_SHR_PCT,
DV.PYMT_LMT_IND,
DV.PYMT_LMT_YR,
DV.PYMT_PTY_RLT_CD,
DV.RCD_REF_PRIM_ID,
DV.RCD_REF_SCND_ID,
DV.SBSD_PRD_STRT_YR,
DV.SBST_CHG_ELG_IND,
DV.SRC_CRE_DT,
DV.SRC_CRE_USER_NM,
DV.SRC_LAST_CHG_DT,
DV.SRC_LAST_CHG_USER_NM,
DV.TAX_ID_TYPE_CD,
DV.TOT_NET_PYMT_AMT,
DV.TOT_PYMT_ATRB_AMT
-- CASE
--    WHEN 
--         DV.PYMT_ATRB_ID IS NOT NULL
--        AND DV.PRPS_PYMT_ID IS NOT NULL
--    THEN 0
--    ELSE 1 
--    END DEF_ERR_IND ,
--MD5(DV.PYMT_ATRB_ID||'~~'||DV.PRPS_PYMT_ID||'~~'|| (DV.DATA_ACTN_DT,TO_TIMESTAMP ('1900-01-01 00:00:00.000000', 'YYYY-MM-DD HH24:MI:SS.FF'))) BUS_KEY,
 /*used by DS job to detect multiple BK records (for single AK field, no hashing required) */
 --('PYMT_ATRB_ID:'||DV.PYMT_ATRB_ID||'~~'||'PRPS_PYMT_ID:'||DV.PRPS_PYMT_ID||'~~'||'DATA_ACTN_DT:'||DV.DATA_ACTN_DT ) BUS_KEY_ERR
From (

SELECT DV_ALL.* FROM 
 (

Select 
 DV_DR.PYMT_ATRB_ID,
 DV_DR.PRPS_PYMT_ID,
 DIR_ATRB_PRPS_PYMT_LS.PRV_PRPS_PYMT_ID,
 DV_DR.PRNT_PYMT_ATRB_ID,
 DV_DR.AGI_ERR_REF_CD,
 DV_DR.BUS_TYPE_CD,
 DV_DR.CASH_RENT_CPLD_FCTR,
 DV_DR.CMB_PTY_PYMT_SHR_PCT,
 DV_DR.MBR_CTRB_SHR_PCT,
 DV_DR.MBR_SHR_PCT,
 DV_DR.NET_PYMT_AMT,
 DV_DR.OWNSHP_HRCH_LVL_SHR_PCT,
 DV_DR.PAID_PTY_SHR_PCT,
 DV_DR.PGM_INELG_RSN_TYPE_CD,
 DV_DR.PYMT_ATRB_AMT,
 DV_DR.PYMT_ATRB_BUS_CAT_CD,
 DV_DR.DATA_STAT_CD PYMT_ATRB_DATA_STAT_CD,
 DV_DR.PYMT_ATRB_SHR_PCT,
 DV_DR.PYMT_PTY_RLT_CD,
 DV_DR.SRC_CRE_DT,
 DV_DR.SRC_CRE_USER_NM,
 DV_DR.SRC_LAST_CHG_DT,
 DV_DR.SRC_LAST_CHG_USER_NM,
 DV_DR.TAX_ID_TYPE_CD,
 DV_DR.TOT_NET_PYMT_AMT,
 DV_DR.TOT_PYMT_ATRB_AMT,
 DV_DR.DATA_ACTN_DT,
 DV_DR.DATA_ACTN_DT as LATEST_PYMT_ATRB_TXN_IND,
 coalesce(PGM_YR_DIM.PGM_YR,-1) SBSD_PRD_STRT_YR,
 DIR_ATRB_PRPS_PYMT_LS.PYMT_AMT PRPS_PYMT_AMT,
 DIR_ATRB_PRPS_PYMT_LS.CMDY_CD,
 DIR_ATRB_PRPS_PYMT_LS.DATA_STAT_CD PRPS_PYMT_DATA_STAT_CD,
 DIR_ATRB_PRPS_PYMT_LS.OBL_CNFRM_NBR,
 DIR_ATRB_PRPS_PYMT_LS.OVRRD_SBSD_PRD_STRT_YR,
 DIR_ATRB_PRPS_PYMT_LS.PROC_RQST_REF_NBR,
 DIR_ATRB_PRPS_PYMT_LS.PYMT_ATRB_RVRS_DT,
 Case UPPER(DV_DR.AGI_ELG_IND)  when 'Y' Then 1  when 'N' Then 0 else -1 END AS AGI_ELG_IND,
 Case UPPER(DV_DR.FGN_PRSN_ELG_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS FGN_PRSN_ELG_IND,
 Case UPPER(DV_DR.MBR_CTRB_ELG_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS MBR_CTRB_ELG_IND,
 Case UPPER(DV_DR.PMIT_ENTY_ELG_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS PMIT_ENTY_ELG_IND,
 Case UPPER(DV_DR.SBST_CHG_ELG_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS SBST_CHG_ELG_IND,
 Case UPPER(DIR_ATRB_PRPS_PYMT_LS.APP_3_OWNSHP_LVL_LMT_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS APP_3_OWNSHP_LVL_LMT_IND,
 Case UPPER(DIR_ATRB_PRPS_PYMT_LS.HRCH_PYMT_LMT_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS HRCH_PYMT_LMT_IND,
 Case  UPPER(DIR_ATRB_PRPS_PYMT_LS.PRST_OPYMT_ATRB_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS PRST_OPYMT_ATRB_IND,
 Case UPPER(DIR_ATRB_PRPS_PYMT_LS.PYMT_LMT_IND) when 'Y' Then 1  when 'N' Then 0 else -1 END AS PYMT_LMT_IND,
 DIR_ATRB_PRPS_PYMT_LS.PYMT_LMT_YR,
 DIR_ATRB_PRPS_PYMT_LS.RCD_REF_PRIM_ID,
 DIR_ATRB_PRPS_PYMT_LS.RCD_REF_SCND_ID,
 coalesce(LTD_PYMT_PGM_DIM.LTD_PYMT_PGM_DURB_ID,-3) LTD_PYMT_PGM_DURB_ID,
 coalesce(LTD_PYMT_PGM_DIM.LTD_PYMT_PGM_SRGT_ID,-3) LTD_PYMT_PGM_SRGT_ID,
 coalesce(ACCT_REF_TYPE_PRIM_DIM.ACCT_REF_TYPE_DURB_ID,-3) ACCT_REF_PRIM_ID_TYPE_DURB_ID,
 coalesce(ACCT_REF_TYPE_SCND_DIM.ACCT_REF_TYPE_DURB_ID,-3) ACCT_REF_SCND_ID_TYPE_DURB_ID,
 coalesce(ACCT_PGM_DIM.ACCT_PGM_DURB_ID,-3) ACCT_PGM_DURB_ID,
 coalesce(FSA_ST_CNTY_DIM.FSA_ST_CNTY_DURB_ID,-3) FSA_ST_CNTY_DURB_ID,
 coalesce(FSA_ST_CNTY_DIM.FSA_ST_CNTY_SRGT_ID,-3) FSA_ST_CNTY_SRGT_ID,
 coalesce(CUST_DIM.CUST_DURB_ID,-3) PRIM_CUST_DURB_ID,
 coalesce(CUST_DIM.CUST_SRGT_ID,-3) PRIM_CUST_SRGT_ID,
 coalesce(MBR_CUST_DM.CUST_DURB_ID,-3) MBR_CUST_DURB_ID,
 coalesce(MBR_CUST_DM.CUST_SRGT_ID,-3) MBR_CUST_SRGT_ID,
 coalesce(PRNT_MBR_CUST_DM.CUST_DURB_ID,-3) PRNT_MBR_CUST_DURB_ID,
 coalesce(PRNT_MBR_CUST_DM.CUST_SRGT_ID,-3) PRNT_MBR_CUST_SRGT_ID,
 coalesce(RPT_FSA_ST_CNTY_DIM.RPT_FSA_ST_CNTY_SRGT_ID,-3) MBR_RPT_FSA_ST_CNTY_SRGT_ID,
 coalesce(RPT_FSA_ST_CNTY_DIM.RPT_FSA_ST_CNTY_DURB_ID,-3) MBR_RPT_FSA_ST_CNTY_DURB_ID,
 RANK() over ( partition by  DV_DR.PYMT_ATRB_ID,    DV_DR.PRPS_PYMT_ID   , (DV_DR.DATA_ACTN_DT,TO_TIMESTAMP ('1900-01-01 00:00:00.000000', 'YYYY-MM-DD HH24:MI:SS.FF') ) Order by DATA_ACTN_DT asc,
         CASE DV_DR.DATA_STAT_CD
         WHEN 'A' THEN 1
         WHEN 'I' THEN 2
         WHEN 'D' THEN 3
         ELSE 4
         END ASC,
      DV_DR.SRC_CRE_DT DESC NULLS LAST
       )  as Rank_Part

FROM
(
SELECT   PYMT_ATRB_ID,
         PRPS_PYMT_ID,
         PRNT_PYMT_ATRB_ID,
         AGI_ELG_IND,
         AGI_ERR_REF_CD,
         BUS_TYPE_CD,
         CASH_RENT_CPLD_FCTR,
         CMB_PTY_PYMT_SHR_PCT,
         FGN_PRSN_ELG_IND,
         MBR_CTRB_ELG_IND,
         MBR_CTRB_SHR_PCT,
         MBR_SHR_PCT,
         NET_PYMT_AMT,
         OWNSHP_HRCH_LVL_SHR_PCT,
         PAID_PTY_SHR_PCT,
         PGM_INELG_RSN_TYPE_CD,
         PMIT_ENTY_ELG_IND,
         PYMT_ATRB_AMT,
         PYMT_ATRB_BUS_CAT_CD,
         PYMT_ATRB_SHR_PCT,
         PYMT_PTY_RLT_CD,
         SBST_CHG_ELG_IND,
         SRC_CRE_DT,
         SRC_CRE_USER_NM,
         SRC_LAST_CHG_DT,
         SRC_LAST_CHG_USER_NM,
         TAX_ID_TYPE_CD,
         TOT_NET_PYMT_AMT,
         TOT_PYMT_ATRB_AMT,
         DATA_STAT_CD,
         PAID_CORE_CUST_ID,MBR_CORE_CUST_ID,PRNT_PYMT_ATRB_CORE_CUST_ID,
         TO_TIMESTAMP ('', 'YYYY:MM:DD HH:MM;SS.FF') DATA_ACTN_DT
  FROM   EDV.PYMT_ATRB_MBR_HLS
 WHERE    (DATA_EFF_END_DT) = TO_TIMESTAMP ('9999-12-31', 'YYYY-MM-DD') 
         AND (DATA_EFF_STRT_DT) <=  TO_TIMESTAMP('{ETL_START_DATE}','YYYY-MM-DD')
         --AND PRPS_PYMT_ID IN (260300, 985150, 8981182, 836100)
UNION
SELECT   PYMT_ATRB_ID,
         PRPS_PYMT_ID,
         PRNT_PYMT_ATRB_ID,
         AGI_ELG_IND,
         AGI_ERR_REF_CD,
         BUS_TYPE_CD,
         CASH_RENT_CPLD_FCTR,
         CMB_PTY_PYMT_SHR_PCT,
         FGN_PRSN_ELG_IND,
         MBR_CTRB_ELG_IND,
         MBR_CTRB_SHR_PCT,
         MBR_SHR_PCT,
         NET_PYMT_AMT,
         OWNSHP_HRCH_LVL_SHR_PCT,
         PAID_PTY_SHR_PCT,
         PGM_INELG_RSN_TYPE_CD,
         PMIT_ENTY_ELG_IND,
         PYMT_ATRB_AMT,
         PYMT_ATRB_BUS_CAT_CD,
         PYMT_ATRB_SHR_PCT,
         PYMT_PTY_RLT_CD,
         SBST_CHG_ELG_IND,
         SRC_CRE_DT,
         SRC_CRE_USER_NM,
         SRC_LAST_CHG_DT,
         SRC_LAST_CHG_USER_NM,
         TAX_ID_TYPE_CD,
         TOT_NET_PYMT_AMT,
         TOT_PYMT_ATRB_AMT,
         DATA_STAT_CD,
         PAID_CORE_CUST_ID,MBR_CORE_CUST_ID,PRNT_PYMT_ATRB_CORE_CUST_ID,
         DATA_ACTN_DT
  FROM   EDV.PR_PYMT_ATRB_MBR_HLS
 WHERE    (DATA_EFF_END_DT) = TO_TIMESTAMP ('9999-12-31', 'YYYY-MM-DD') 
          AND (DATA_EFF_STRT_DT) <=  TO_TIMESTAMP('{ETL_START_DATE}','YYYY-MM-DD')
        -- AND PRPS_PYMT_ID IN (260300, 985150, 8981182, 836100)
) DV_DR

 Left JOIN
 (
    
     Select * From EDV.DIR_ATRB_PRPS_PYMT_LS  
     where (DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD')
           AND (DATA_EFF_STRT_DT) <=  TO_TIMESTAMP('{ETL_START_DATE}','YYYY-MM-DD')          
         -- And PRPS_PYMT_ID IN (260300,985150,8981182,836100)
 ) DIR_ATRB_PRPS_PYMT_LS
ON (DV_DR.PRPS_PYMT_ID =DIR_ATRB_PRPS_PYMT_LS.PRPS_PYMT_ID)

Left Join EDV.PYMT_PGM_RS
  ON ( DIR_ATRB_PRPS_PYMT_LS.PYMT_PGM_ID = PYMT_PGM_RS.PYMT_PGM_ID And  (PYMT_PGM_RS.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD') )
   
  Left Join pymt_dm_stg.LTD_PYMT_PGM_DIM
  ON ( PYMT_PGM_RS.PYMT_PGM_NM = LTD_PYMT_PGM_NM And  (LTD_PYMT_PGM_DIM.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD') )
  
Left Join pymt_dm_stg.ACCT_REF_TYPE_DIM  ACCT_REF_TYPE_PRIM_DIM
  ON (DIR_ATRB_PRPS_PYMT_LS.RCD_REF_PRIM_ID_TYPE_CD =ACCT_REF_TYPE_PRIM_DIM.ACCT_REF_CD And ACCT_REF_TYPE_PRIM_DIM.DATA_STAT_CD ='A' And ACCT_REF_TYPE_PRIM_DIM.ACCT_REF_TYPE_DURB_ID > 0 )
  
  
  Left Join pymt_dm_stg.ACCT_REF_TYPE_DIM  ACCT_REF_TYPE_SCND_DIM
  ON( DIR_ATRB_PRPS_PYMT_LS.RCD_REF_SCND_ID_TYPE_CD =ACCT_REF_TYPE_SCND_DIM.ACCT_REF_CD And ACCT_REF_TYPE_SCND_DIM.DATA_STAT_CD ='A' And ACCT_REF_TYPE_SCND_DIM.ACCT_REF_TYPE_DURB_ID > 0)
  
  Left Join cmn_dim_dm_stg.ACCT_PGM_DIM
  ON  ( DIR_ATRB_PRPS_PYMT_LS.ACCT_PGM_CD = ACCT_PGM_DIM.ACCT_PGM_CD And ACCT_PGM_DIM.DATA_STAT_CD ='A')
    
  LEFT  JOIN 
   (
        SELECT FSA_ST_CNTY_SRGT_ID,FSA_ST_CNTY_DURB_ID ,ST_FSA_CD ,CNTY_FSA_CD,ST_NM,CNTY_NM
        ,ROW_NUMBER() OVER ( PARTITION BY ST_FSA_CD  ,CNTY_FSA_CD ORDER BY CRE_DT DESC
        ) AS PRECEDENCE
        FROM cmn_dim_dm_stg.FSA_ST_CNTY_DIM
        WHERE CUR_RCD_IND = 1
   ) FSA_ST_CNTY_DIM 
  ON ( DIR_ATRB_PRPS_PYMT_LS.ST_FSA_CD=FSA_ST_CNTY_DIM.ST_FSA_CD   And DIR_ATRB_PRPS_PYMT_LS.CNTY_FSA_CD = FSA_ST_CNTY_DIM.CNTY_FSA_CD AND FSA_ST_CNTY_DIM.PRECEDENCE = 1 )  

  Left join cmn_dim_dm_stg.CUST_DIM 
  On ( DIR_ATRB_PRPS_PYMT_LS.PAID_CORE_CUST_ID = CUST_DIM.CORE_CUST_ID  And CUST_DIM.CUR_RCD_IND =1 And (CUST_DIM.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD') ) 
        
   Left join cmn_dim_dm_stg.CUST_DIM MBR_CUST_DM
  On ( DV_DR.MBR_CORE_CUST_ID = MBR_CUST_DM.CORE_CUST_ID  And MBR_CUST_DM.CUR_RCD_IND =1 And (MBR_CUST_DM.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD') )
  
    Left join cmn_dim_dm_stg.CUST_DIM PRNT_MBR_CUST_DM
  On ( DV_DR.PRNT_PYMT_ATRB_CORE_CUST_ID = PRNT_MBR_CUST_DM.CORE_CUST_ID  And PRNT_MBR_CUST_DM.CUR_RCD_IND =1 And (PRNT_MBR_CUST_DM.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD') )
  
  Left Join 
   (
           Select * from (
        SELECT FSA_ST_CNTY_SRGT_ID RPT_FSA_ST_CNTY_SRGT_ID ,FSA_ST_CNTY_DURB_ID RPT_FSA_ST_CNTY_DURB_ID ,ST_FSA_CD ,CNTY_FSA_CD,ST_NM,CNTY_NM
        ,ROW_NUMBER() OVER ( PARTITION BY ST_FSA_CD  ,CNTY_FSA_CD ORDER BY CRE_DT DESC) AS PRECEDENCE
        FROM cmn_dim_dm_stg.FSA_ST_CNTY_DIM
        WHERE CUR_RCD_IND = 1   ) FSA_ST_CNTY_DIM JOIN cmn_dim_dm_stg.CUST_DIM  
                ON (FSA_ST_CNTY_DIM.ST_FSA_CD = CUST_DIM.RPT_ST_FSA_CD And FSA_ST_CNTY_DIM.CNTY_FSA_CD = CUST_DIM.RPT_CNTY_FSA_CD
                And   (CUST_DIM.DATA_EFF_END_DT) = TO_TIMESTAMP('9999-12-31','YYYY-MM-DD')                 And  FSA_ST_CNTY_DIM.PRECEDENCE=1 
                    )
   ) RPT_FSA_ST_CNTY_DIM
  ON ( DV_DR.MBR_CORE_CUST_ID= RPT_FSA_ST_CNTY_DIM.CORE_CUST_ID)


  Left Join cmn_dim_dm_stg.PGM_YR_DIM
  on (  DIR_ATRB_PRPS_PYMT_LS.SBSD_PRD_STRT_YR = PGM_YR_DIM.PGM_YR And PGM_YR_DIM.DATA_STAT_CD ='A')
  
  Order by  DV_DR.PYMT_ATRB_ID,  DV_DR.PRPS_PYMT_ID asc
    ) DV_ALL
   WHERE DV_ALL.Rank_Part = 1 
 ) dv 
 
 /* LEFT JOIN  pymt_dm_stg.DA_MBR_CUST_ATRB_TXN_FACT dm
  on (
  (dv.PYMT_ATRB_ID,0) = (dm.PYMT_ATRB_ID,0)
  And (dv.PRPS_PYMT_ID,0) = (dm.PRPS_PYMT_ID,0)
  And (DV.DATA_ACTN_DT,TO_TIMESTAMP ('1900-01-01 00:00:00.000000', 'YYYY-MM-DD HH24:MI:SS.FF') ) = (dm.DATA_ACTN_DT,TO_TIMESTAMP ('1900-01-01 00:00:00.000000', 'YYYY-MM-DD HH24:MI:SS.FF') )
  And dm.DATA_STAT_CD = 'A' 
 ) 
 where
  (
   dm.PYMT_ATRB_ID IS NULL 
   And dm.PRPS_PYMT_ID is Null
   And dm.DATA_ACTN_DT is NUll
  ) */
 ORDER BY LAST_CHG_DT asc 