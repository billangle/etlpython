INSERT INTO EDV.PYMT_ATRB_SIM_LS (DIR_ATRB_PRPS_PYMT_L_ID, PYMT_ATRB_SIM_ID, ACCT_PGM_CD, AGI_ELG_IND, AGI_ERR_REF_CD, BUS_TYPE_CD, CASH_RENT_CPLD_FCTR, CMB_PTY_PYMT_SHR_PCT, CNTY_FSA_CD, DATA_EFF_STRT_DT, DATA_SRC_NM, DATA_STAT_CD, FGN_PRSN_ELG_IND, LOAD_DT, MBR_CORE_CUST_ID, MBR_CTRB_ELG_IND, MBR_CTRB_SHR_PCT, MBR_SHR_PCT, NET_PYMT_AMT, OWNSHP_HRCH_LVL_SHR_PCT, PAID_CORE_CUST_ID, PAID_PTY_SHR_PCT, PAID_SBSD_CUST_ID, PGM_IELG_RSN_TYPE_CD, PMIT_ENTY_ELG_IND, PRNT_ATRB_SIM_SBSD_PRD_STRT_YR, PRNT_PYMT_ATRB_CORE_CUST_ID, PRNT_PYMT_ATRB_SIM_ACCT_PGM_CD, PRNT_PYMT_ATRB_SIM_CNTY_FSA_CD, PRNT_PYMT_ATRB_SIM_ID, PRNT_PYMT_ATRB_SIM_ST_FSA_CD, PRPS_PYMT_SIM_ACCT_PGM_CD, PRPS_PYMT_SIM_SBSD_PRD_STRT_YR, PYMT_ATRB_AMT, PYMT_ATRB_BUS_CAT_CD, PYMT_ATRB_SHR_PCT, PRPS_PYMT_SIM_ID, PYMT_LMT_YR, PYMT_PGM_ID, PYMT_PTY_RLT_CD, RCD_REF_PRIM_ID, RCD_REF_PRIM_ID_TYPE_CD, RCD_REF_SCND_ID, RCD_REF_SCND_ID_TYPE_CD, SBSD_CUST_ID, SBSD_PRD_STRT_YR, SBST_CHG_ELG_IND, SRC_CRE_DT, SRC_CRE_USER_NM, SRC_LAST_CHG_DT, SRC_LAST_CHG_USER_NM, ST_FSA_CD, TAX_ID_TYPE_CD, TOT_NET_PYMT_AMT, TOT_PYMT_ATRB_AMT, DATA_EFF_END_DT, LOAD_END_DT, HASH_DIF)
  (SELECT stg.*
   FROM
     (SELECT DISTINCT MD5 (upper(COALESCE (trim(PYMT_ATRB_SIM.ST_FSA_CD), '')) ||'~~'||upper(COALESCE (trim(PYMT_ATRB_SIM.CNTY_FSA_CD), '')) ||'~~'||upper(COALESCE (trim(PYMT_ATRB_SIM.PRPS_PYMT_SIM_ACCT_PGM_CD), '')) ||'~~'||PYMT_ATRB_SIM.PAID_CORE_CUST_ID) AS DIR_ATRB_PRPS_PYMT_L_ID,
                      coalesce(PYMT_ATRB_SIM.PYMT_ATRB_SIM_ID, '-1') PYMT_ATRB_SIM_ID,
                      PYMT_ATRB_SIM.ACCT_PGM_CD ACCT_PGM_CD,
                      PYMT_ATRB_SIM.AGI_ELG_IND AGI_ELG_IND,
                      PYMT_ATRB_SIM.AGI_ERR_REF_CD AGI_ERR_REF_CD,
                      PYMT_ATRB_SIM.BUS_TYPE_CD BUS_TYPE_CD,
                      PYMT_ATRB_SIM.CASH_RENT_CPLD_FCTR CASH_RENT_CPLD_FCTR,
                      PYMT_ATRB_SIM.CMB_PTY_PYMT_SHR_PCT CMB_PTY_PYMT_SHR_PCT,
                      PYMT_ATRB_SIM.CNTY_FSA_CD CNTY_FSA_CD,
                      PYMT_ATRB_SIM.CDC_DT DATA_EFF_STRT_DT,
                      PYMT_ATRB_SIM.DATA_SRC_NM DATA_SRC_NM,
                      PYMT_ATRB_SIM.DATA_STAT_CD DATA_STAT_CD,
                      PYMT_ATRB_SIM.FGN_PRSN_ELG_IND FGN_PRSN_ELG_IND,
                      PYMT_ATRB_SIM.LOAD_DT LOAD_DT,
                      PYMT_ATRB_SIM.MBR_CORE_CUST_ID MBR_CORE_CUST_ID,
                      PYMT_ATRB_SIM.MBR_CTRB_ELG_IND MBR_CTRB_ELG_IND,
                      PYMT_ATRB_SIM.MBR_CTRB_SHR_PCT MBR_CTRB_SHR_PCT,
                      PYMT_ATRB_SIM.MBR_SHR_PCT MBR_SHR_PCT,
                      PYMT_ATRB_SIM.NET_PYMT_AMT NET_PYMT_AMT,
                      PYMT_ATRB_SIM.OWNSHP_HRCH_LVL_SHR_PCT OWNSHP_HRCH_LVL_SHR_PCT,
                      PYMT_ATRB_SIM.PAID_CORE_CUST_ID PAID_CORE_CUST_ID,
                      PYMT_ATRB_SIM.PAID_PTY_SHR_PCT PAID_PTY_SHR_PCT,
                      PYMT_ATRB_SIM.PAID_SBSD_CUST_ID PAID_SBSD_CUST_ID,
                      PYMT_ATRB_SIM.PGM_IELG_RSN_TYPE_CD PGM_IELG_RSN_TYPE_CD,
                      PYMT_ATRB_SIM.PMIT_ENTY_ELG_IND PMIT_ENTY_ELG_IND,
                      PYMT_ATRB_SIM.PRNT_ATRB_SIM_SBSD_PRD_STRT_YR PRNT_ATRB_SIM_SBSD_PRD_STRT_YR,
                      PYMT_ATRB_SIM.PRNT_PYMT_ATRB_CORE_CUST_ID PRNT_PYMT_ATRB_CORE_CUST_ID,
                      PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ACCT_PGM_CD PRNT_PYMT_ATRB_SIM_ACCT_PGM_CD,
                      PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_CNTY_FSA_CD PRNT_PYMT_ATRB_SIM_CNTY_FSA_CD,
                      PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ID PRNT_PYMT_ATRB_SIM_ID,
                      PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ST_FSA_CD PRNT_PYMT_ATRB_SIM_ST_FSA_CD,
                      PYMT_ATRB_SIM.PRPS_PYMT_SIM_ACCT_PGM_CD PRPS_PYMT_SIM_ACCT_PGM_CD,
                      PYMT_ATRB_SIM.PRPS_PYMT_SIM_SBSD_PRD_STRT_YR PRPS_PYMT_SIM_SBSD_PRD_STRT_YR,
                      PYMT_ATRB_SIM.PYMT_ATRB_AMT PYMT_ATRB_AMT,
                      PYMT_ATRB_SIM.PYMT_ATRB_BUS_CAT_CD PYMT_ATRB_BUS_CAT_CD,
                      PYMT_ATRB_SIM.PYMT_ATRB_SHR_PCT PYMT_ATRB_SHR_PCT,
                      PYMT_ATRB_SIM.PRPS_PYMT_SIM_ID PRPS_PYMT_SIM_ID,
                      PYMT_ATRB_SIM.PYMT_LMT_YR PYMT_LMT_YR,
                      PYMT_ATRB_SIM.PYMT_PGM_ID PYMT_PGM_ID,
                      PYMT_ATRB_SIM.PYMT_PTY_RLT_CD PYMT_PTY_RLT_CD,
                      PYMT_ATRB_SIM.RCD_REF_PRIM_ID RCD_REF_PRIM_ID,
                      PYMT_ATRB_SIM.RCD_REF_PRIM_ID_TYPE_CD RCD_REF_PRIM_ID_TYPE_CD,
                      PYMT_ATRB_SIM.RCD_REF_SCND_ID RCD_REF_SCND_ID,
                      PYMT_ATRB_SIM.RCD_REF_SCND_ID_TYPE_CD RCD_REF_SCND_ID_TYPE_CD,
                      PYMT_ATRB_SIM.SBSD_CUST_ID SBSD_CUST_ID,
                      PYMT_ATRB_SIM.SBSD_PRD_STRT_YR SBSD_PRD_STRT_YR,
                      PYMT_ATRB_SIM.SBST_CHG_ELG_IND SBST_CHG_ELG_IND,
                      PYMT_ATRB_SIM.CRE_DT SRC_CRE_DT,
                      PYMT_ATRB_SIM.CRE_USER_NM SRC_CRE_USER_NM,
                      PYMT_ATRB_SIM.LAST_CHG_DT SRC_LAST_CHG_DT,
                      PYMT_ATRB_SIM.LAST_CHG_USER_NM SRC_LAST_CHG_USER_NM,
                      PYMT_ATRB_SIM.ST_FSA_CD ST_FSA_CD,
                      PYMT_ATRB_SIM.TAX_ID_TYPE_CD TAX_ID_TYPE_CD,
                      PYMT_ATRB_SIM.TOT_NET_PYMT_AMT TOT_NET_PYMT_AMT,
                      PYMT_ATRB_SIM.TOT_PYMT_ATRB_AMT TOT_PYMT_ATRB_AMT,
                      to_date('9999-12-31', 'YYYY-MM-DD') DATA_EFF_END_DT,
                      to_date('9999-12-31', 'YYYY-MM-DD') LOAD_END_DT,
                      MD5 (trim(PYMT_ATRB_SIM.ST_FSA_CD)||'~~'||trim(PYMT_ATRB_SIM.CNTY_FSA_CD)||'~~'||trim(PYMT_ATRB_SIM.PRPS_PYMT_SIM_ACCT_PGM_CD)||'~~'||PYMT_ATRB_SIM.PAID_CORE_CUST_ID||'~~'||PYMT_ATRB_SIM.PYMT_ATRB_SIM_ID||'~~'||trim(PYMT_ATRB_SIM.ACCT_PGM_CD)||'~~'||trim(PYMT_ATRB_SIM.AGI_ELG_IND)||'~~'||trim(PYMT_ATRB_SIM.AGI_ERR_REF_CD)||'~~'||trim(PYMT_ATRB_SIM.BUS_TYPE_CD)||'~~'||PYMT_ATRB_SIM.CASH_RENT_CPLD_FCTR||'~~'||PYMT_ATRB_SIM.CMB_PTY_PYMT_SHR_PCT||'~~'||trim(PYMT_ATRB_SIM.CNTY_FSA_CD)||'~~'||trim(PYMT_ATRB_SIM.DATA_STAT_CD)||'~~'||trim(PYMT_ATRB_SIM.FGN_PRSN_ELG_IND)||'~~'||PYMT_ATRB_SIM.MBR_CORE_CUST_ID||'~~'||trim(PYMT_ATRB_SIM.MBR_CTRB_ELG_IND)||'~~'||PYMT_ATRB_SIM.MBR_CTRB_SHR_PCT||'~~'||PYMT_ATRB_SIM.MBR_SHR_PCT||'~~'||PYMT_ATRB_SIM.NET_PYMT_AMT||'~~'||PYMT_ATRB_SIM.OWNSHP_HRCH_LVL_SHR_PCT||'~~'||PYMT_ATRB_SIM.PAID_CORE_CUST_ID||'~~'||PYMT_ATRB_SIM.PAID_PTY_SHR_PCT||'~~'||PYMT_ATRB_SIM.PAID_SBSD_CUST_ID||'~~'||trim(PYMT_ATRB_SIM.PGM_IELG_RSN_TYPE_CD)||'~~'||trim(PYMT_ATRB_SIM.PMIT_ENTY_ELG_IND)||'~~'||PYMT_ATRB_SIM.PRNT_ATRB_SIM_SBSD_PRD_STRT_YR||'~~'||PYMT_ATRB_SIM.PRNT_PYMT_ATRB_CORE_CUST_ID||'~~'||trim(PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ACCT_PGM_CD)||'~~'||trim(PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_CNTY_FSA_CD)||'~~'||PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ID||'~~'||trim(PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ST_FSA_CD)||'~~'||trim(PYMT_ATRB_SIM.PRPS_PYMT_SIM_ACCT_PGM_CD)||'~~'||PYMT_ATRB_SIM.PRPS_PYMT_SIM_SBSD_PRD_STRT_YR||'~~'||PYMT_ATRB_SIM.PYMT_ATRB_AMT||'~~'||trim(PYMT_ATRB_SIM.PYMT_ATRB_BUS_CAT_CD)||'~~'||PYMT_ATRB_SIM.PYMT_ATRB_SHR_PCT||'~~'||PYMT_ATRB_SIM.PRPS_PYMT_SIM_ID||'~~'||PYMT_ATRB_SIM.PYMT_LMT_YR||'~~'||PYMT_ATRB_SIM.PYMT_PGM_ID||'~~'||trim(PYMT_ATRB_SIM.PYMT_PTY_RLT_CD)||'~~'||trim(PYMT_ATRB_SIM.RCD_REF_PRIM_ID)||'~~'||trim(PYMT_ATRB_SIM.RCD_REF_PRIM_ID_TYPE_CD)||'~~'||trim(PYMT_ATRB_SIM.RCD_REF_SCND_ID)||'~~'||trim(PYMT_ATRB_SIM.RCD_REF_SCND_ID_TYPE_CD)||'~~'||PYMT_ATRB_SIM.SBSD_CUST_ID||'~~'||PYMT_ATRB_SIM.SBSD_PRD_STRT_YR||'~~'||trim(PYMT_ATRB_SIM.SBST_CHG_ELG_IND)||'~~'||to_char(PYMT_ATRB_SIM.CRE_DT, 'YYYY-MM-DD HH24:MI:SS.FF')||'~~'||trim(PYMT_ATRB_SIM.CRE_USER_NM)||'~~'||to_char(PYMT_ATRB_SIM.LAST_CHG_DT, 'YYYY-MM-DD HH24:MI:SS.FF')||'~~'||trim(PYMT_ATRB_SIM.LAST_CHG_USER_NM)||'~~'||trim(PYMT_ATRB_SIM.ST_FSA_CD)||'~~'||trim(PYMT_ATRB_SIM.TAX_ID_TYPE_CD)||'~~'||PYMT_ATRB_SIM.TOT_NET_PYMT_AMT||'~~'||PYMT_ATRB_SIM.TOT_PYMT_ATRB_AMT) HASH_DIF
      FROM SBSD_STG.PYMT_ATRB_SIM PYMT_ATRB_SIM
      WHERE PYMT_ATRB_SIM.CDC_OPER_CD IN ('I',
                                          'UN')
        AND PYMT_ATRB_SIM.PRNT_PYMT_ATRB_SIM_ID IS NULL
        AND date(PYMT_ATRB_SIM.CDC_DT) = date(TO_TIMESTAMP ('{ETL_START_TIMESTAMP}', 'YYYY-MM-DD HH24:MI:SS.FF'))
      ORDER BY PYMT_ATRB_SIM.CDC_DT) stg
   LEFT JOIN EDV.PYMT_ATRB_SIM_LS dv ON (stg.HASH_DIF = dv.HASH_DIF
                                         AND dv.LOAD_END_DT = TO_TIMESTAMP('9999-12-31', 'YYYY-MM-DD'))
   WHERE dv.HASH_DIF IS NULL )